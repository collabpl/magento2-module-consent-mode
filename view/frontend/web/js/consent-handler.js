define(["jquery","uiComponent","mage/cookies"],function(o,e){return e.extend({initialize:function(e){this.moduleConfig=e||{},this.checkIfNeedsToDisplay(),this.initInputsState(),this.handleClicks(this.moduleConfig.buttons)},checkIfNeedsToDisplay:function(){var e;null!==JSON.parse(localStorage.getItem("consent-mode"))&&null!==o.mage.cookies.get(this.moduleConfig.cookieName)||(e=this.moduleConfig.cookieBlock,document.getElementById(e).style.display="block")},initInputsState:function(){var e=JSON.parse(localStorage.getItem("consent-mode"));null!==e&&(document.getElementById(this.moduleConfig.consentBoxes.marketing).checked="granted"===e.ad_storage,document.getElementById(this.moduleConfig.consentBoxes.analytics).checked="granted"===e.analytics_storage,document.getElementById(this.moduleConfig.consentBoxes.preferences).checked="granted"===e.personalization)},handleClicks:function(n){for(let[e,t]of Object.entries(n))document.getElementById(t).addEventListener("click",function(){this.handleButton(e)}.bind(this))},handleButton:function(e){var t={necessary:!0,marketing:!1,analytics:!1,preferences:!1};switch(e){case"allow":for(var[n,o]of Object.entries(this.moduleConfig.consentBoxes))t[n]=document.getElementById(o).checked=!0;break;case"reject":window.location.href=this.moduleConfig.noCookiesUrl;break;case"partial":this.handleNativeConsent();for(var[i,s]of Object.entries(this.moduleConfig.consentBoxes))t[i]=document.getElementById(s).checked}this.setConsent(t)},handleNativeConsent:function(){var e=new Date((new Date).getTime()+1e3*this.moduleConfig.cookieLifetime),t=this.moduleConfig.cookieBlock,n=this.moduleConfig.mode||!1;o.mage.cookies.set(this.moduleConfig.cookieName,JSON.stringify(this.moduleConfig.cookieValue),{expires:e}),o.mage.cookies.get(this.moduleConfig.cookieName)&&(n||(document.getElementById(t).style.display="none"),o(document).trigger("user:allowed:save:cookie"))},setConsent:function(e){e={functionality_storage:e.necessary?"granted":"denied",security_storage:e.necessary?"granted":"denied",ad_storage:e.marketing?"granted":"denied",analytics_storage:e.analytics?"granted":"denied",personalization:e.preferences?"granted":"denied"};localStorage.setItem("consent-mode",JSON.stringify(e)),gtag("consent","update",e)}})});